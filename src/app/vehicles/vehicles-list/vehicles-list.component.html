<div class="container mb-3">
  <div class="tab-bar">
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link" href="/vehicles/air" [ngClass]="{'active' : type === 'air'}">Air Vehicles</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/vehicles/ground" [ngClass]="{'active' : type === 'ground'}">Ground Vehicles</a>
      </li>
    </ul>
  </div>
</div>

<div class="container-fluid ">
  <div class="d-flex justify-content-center flex-nowrap m-3">
    <button class="btn btn-outline-secondary col-md-9 mx-auto" id="filters-btn" (click)="hideFilters = !hideFilters" [ngClass]="{'active' : !hideFilters}">filters</button>
  </div>
  <div class="row">
    <div [hidden]="hideFilters" class="col-md-9 mx-auto">
      <form class="form-floating form-inline">
        <div class="mb-2">
          <div class="filter-label">Rank:
            <button class="btn btn-light btn-sm" (click)="checkAll('ranks')">all</button>
            <span> | </span>
            <button class="btn btn-light btn-sm" (click)="uncheckAll('ranks')">none</button>
            <div class="offset-1">
              <div class="form-check-inline" *ngFor="let rank of ranks">
                <label class="form-check-label">
                  <input class="form-check-input" type="checkbox" name="rank" [value]="rank.value" [checked]="rank.checked"  (change)="rank.checked = !rank.checked">
                  {{rank.name}}
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-2" id="nation-filter">
          <div class="filter-label">Nation:
            <button class="btn btn-light btn-sm" (click)="checkAll('nations')">all</button>
            <span> | </span>
            <button class="btn btn-light btn-sm" (click)="uncheckAll('nations')">none</button>
            <div class="offset-1">
              <div class="form-check-inline" *ngFor="let nation of nations">
                <label class="form-check-label">
                  <input class="form-check-input"  type="checkbox" name="nation" [value]="nation.value" [checked]="nation.checked" (change)="nation.checked = !nation.checked">
                  {{nation.name}}
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-2" id="br-filter">
          <div class="filter-label">Battle rating:</div>
          <div class="offset-1 row-cols-sm-4">
            <div class="d-lg-inline-flex form-check-inline">
              <select class="form-select form-select-sm col" name="lower-br" [(ngModel)]="lowerBr">
                <option *ngFor="let br of brs; first as firstElement" [value]="br.value" [selected]="firstElement">{{br.name}}</option>
              </select>
              <div class="col justify-content-center d-lg-inline-flex">-</div>
              <select class="form-select form-select-sm col" name="upper-br" [(ngModel)]="upperBr">
                <option *ngFor="let br of brs; last as lastElement" [value]="br.value" [selected]="lastElement">{{br.name}}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="mb-2" id="class-filters" >
          <div [hidden]="(type !== 'ground')" class="filters" id="army-class-filter" >
            <div class="filter-label">Class:
              <button class="btn btn-light btn-sm" (click)="checkAll('groundVehicleClasses')">all</button>
              <span> | </span>
              <button class="btn btn-light btn-sm" (click)="uncheckAll('groundVehicleClasses')">none</button>
              <div class="offset-1">
                <div class="form-check-inline" *ngFor="let klass of groundVehicleClasses">
                  <label class="form-check-label">
                    <input class="form-check-input" type="checkbox" name="ground-class" [value]="klass.value" [checked]="klass.checked"  (change)="klass.checked = !klass.checked">
                    {{klass.name}}
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div [hidden]="(type !== 'air')" class="mb-2" id="aviation-class-filter" >
            <div class="filter-label">Class:
              <button class="btn btn-light btn-sm" (click)="checkAll('aircraftClasses')">all</button>
              <span> | </span>
              <button class="btn btn-light btn-sm" (click)="uncheckAll('aircraftClasses')">none</button>
              <div class="offset-1">
                <div class="form-check-inline" *ngFor="let klass of aircraftClasses">
                  <label class="form-check-label">
                    <input class="form-check-input"  type="checkbox" name="air-class" [value]="klass.value" [checked]="klass.checked" (change)="klass.checked = !klass.checked">
                    {{klass.name}}
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mb-2" id="status-filters">
          <div class="filter-label">Status:
            <button class="btn btn-light btn-sm" (click)="checkAll('status')">all</button>
            <span> | </span>
            <button class="btn btn-light btn-sm" (click)="uncheckAll('status')">none</button>
            <div class="offset-1">
              <div class="form-check-inline" *ngFor="let status of status">
                <label class="form-check-label">
                  <input class="form-check-input"  type="checkbox" name="status" [value]="status.value" [checked]="status.checked" (change)="status.checked = !status.checked">
                  {{status.name}}
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-center flex-nowrap">
          <button class="btn btn-primary col-sm-4" (click)="filterList()">filter</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="table-responsive">
    <table class="table table-striped table-hover" id="sortTable">
      <colgroup>
        <col span="5">
      </colgroup>
      <colgroup class="border-start border-end">
        <col span="3">
      </colgroup>
      <colgroup class="border-start border-end">
        <col span="3">
      </colgroup>
      <colgroup class="border-start border-end">
        <col span="3">
      </colgroup>
      <thead>
      <tr>
        <th scope="col" rowspan="2" class="text-md-start"># </th>
        <th scope="col" rowspan="2" class="text-md-center"><img src="/assets/icons/rank_icon.png" alt="rank" width="36" height="36"/></th>
        <th scope="col" rowspan="2" class="text-md-center"><img src="/assets/icons/world_icon.png" alt="nation" width="36" height="36"/></th>
        <th scope="col" rowspan="2" class="text-md-center">Class</th>
        <th scope="col" rowspan="2" class="text-md-center">Name</th>
        <th colspan="3" class="pt-0 pb-0 text-md-center">Arcade</th>
        <th colspan="3" class="pt-0 pb-0 text-md-center">Realistic</th>
        <th colspan="3" class="pt-0 pb-0 text-md-center">Simulation</th>
      </tr>
      <tr class="">
        <th scope="col" class="col-xs-1 pt-0 pb-0 text-md-center"><img src="/assets/icons/battles_icon.png" alt="battles" width="24" height="24"/></th>
        <th scope="col" class="col-xs-1 pt-0 pb-0 text-md-center"><img src="/assets/icons/win_ratio_icon.png" alt="win ratio" width="24" height="24"/></th>
        <th scope="col" class="col-xs-1 pt-0 pb-0 text-md-center"><img src="/assets/icons/kill_deaths_icon.png" alt="kills/death ratio" width="24" height="24"/></th>
        <th scope="col" class="col-xs-1 pt-0 pb-0 text-md-center"><img src="/assets/icons/battles_icon.png" alt="battles" width="24" height="24"/></th>
        <th scope="col" class="col-xs-1 pt-0 pb-0 text-md-center"><img src="/assets/icons/win_ratio_icon.png" alt="win ratio" width="24" height="24"/></th>
        <th scope="col" class="col-xs-1 pt-0 pb-0 text-md-center"><img src="/assets/icons/kill_deaths_icon.png" alt="kills/death ratio" width="24" height="24"/></th>
        <th scope="col" class="col-xs-1 pt-0 pb-0 text-md-center"><img src="/assets/icons/battles_icon.png" alt="battles" width="24" height="24"/></th>
        <th scope="col" class="col-xs-1 pt-0 pb-0 text-md-center"><img src="/assets/icons/win_ratio_icon.png" alt="win ratio" width="24" height="24"/></th>
        <th scope="col" class="col-xs-1 pt-0 pb-0 text-md-center"><img src="/assets/icons/kill_deaths_icon.png" alt="kills/death ratio" width="24" height="24"/></th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let v of allVehicles | async; let i = index">
        <td class="text-md-start">{{i+1}}</td>
        <td class="text-md-center">{{v.vehicleInfo.rank}}</td>
        <td class="text-md-center"><img src="/assets/flags/{{v.vehicleInfo.nation}}_flag.png" width="40" height="20"></td>
        <td><img src="/assets/vehicle_icons/{{v.vehicleInfo.klass}}_icon.png" width="40" height="20"></td>
        <td><a class="link-dark" href="vehicle/{{v.vehicleInfo.vehicle_id}}">{{v.vehicleInfo.name}}</a></td>
        <td class="text-md-end">{{v.arcade.battles}}</td>
        <td class="text-md-end">{{(v.arcade.wins/v.arcade.battles*100).toFixed(2).substr(0,5)}}</td>
        <td class="text-md-end">{{((v.arcade.ground_kills+v.arcade.air_kills)/v.arcade.deaths).toFixed(2)}}</td>
        <td class="text-md-end">{{v.realistic.battles}}</td>
        <td class="text-md-end">{{(v.realistic.wins/v.realistic.battles*100).toFixed(2).substr(0,5)}}</td>
        <td class="text-md-end">{{((v.realistic.ground_kills+v.realistic.air_kills)/v.realistic.deaths).toFixed(2)}}</td>
        <td class="text-md-end">{{v.simulation.battles}}</td>
        <td class="text-md-end">{{(v.simulation.wins/v.simulation.battles*100).toFixed(2).substr(0,5)}}</td>
        <td class="text-md-end">{{((v.simulation.ground_kills+v.simulation.air_kills)/v.simulation.deaths).toFixed(2)}}</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
